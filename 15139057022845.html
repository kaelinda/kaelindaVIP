<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  Rect-Native ä¹‹ Promise æ·±å…¥æµ…å‡ºä»å…¥é—¨åˆ°ç²¾é€š - kaelinda
  
  </title>
  
  
  <link href="atom.xml" rel="alternate" title="kaelinda" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />
    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
  <script src="asset/highlightjs/highlight.pack.js"></script>
  <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script>hljs.initHighlightingOnLoad();</script>
<script type="text/javascript">
  function before_search(){
    var searchVal = 'site:kaelinda.top ' + document.getElementById('search_input').value;
    document.getElementById('search_q').value = searchVal;
    return true;
  }
</script>
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>


  <section class="top-bar-section">
  <div class="row">
      <div style="position: relative;width:100%;"><div style="position: absolute; width:100%;">
        <ul id="main-menu" class="left">
        
        <li id=""><a target="_self" href="index.html">æœ€è¿‘æ›´æ–°</a></li>
        
        <li id=""><a target="_self" href="archives.html">å½’æ¡£ç›®å½•</a></li>
        
        <li id="ios.css"><a target="_self" href="ios.html">iOS</a></li>
        
        <li id="swift.css"><a target="_self" href="swift.html">Swift</a></li>
        
        <li id="reactnative.css"><a target="_self" href="reactnative.html">RN</a></li>
        
        <li id="js.css"><a target="_self" href="js.html">JS</a></li>
        
        <li id="shell.css"><a target="_self" href="shell.html">shell</a></li>
        
        <li id="coding.css"><a target="_self" href="coding.html">ç¼–ç¨‹</a></li>
        
        <li id="live.css"><a target="_self" href="live.html">éšç¬”</a></li>
        
        <li id="app.css"><a target="_blank" href="app.html">APPæ¨è</a></li>
        
        </ul>

        <ul class="right" id="search-wrap">
          <li>
<form target="_blank" onsubmit="return before_search();" action="http://google.com/search" method="get">
    <input type="hidden" id="search_q" name="q" value="" />
    <input tabindex="1" type="search" id="search_input"  placeholder="Search"/>
</form>
</li>
          </ul>
      </div></div>
  </div>
  </section>

</nav>

        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; kaelinda</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
        
        <li><a target="_self" href="index.html">æœ€è¿‘æ›´æ–°</a></li>
        
        <li><a target="_self" href="archives.html">å½’æ¡£ç›®å½•</a></li>
        
        <li><a target="_self" href="ios.html">iOS</a></li>
        
        <li><a target="_self" href="swift.html">Swift</a></li>
        
        <li><a target="_self" href="reactnative.html">RN</a></li>
        
        <li><a target="_self" href="js.html">JS</a></li>
        
        <li><a target="_self" href="shell.html">shell</a></li>
        
        <li><a target="_self" href="coding.html">ç¼–ç¨‹</a></li>
        
        <li><a target="_self" href="live.html">éšç¬”</a></li>
        
        <li><a target="_blank" href="app.html">APPæ¨è</a></li>
        

    <li><label>Categories</label></li>

        
            <li><a href="reactnative.html">React-Native</a></li>
        
            <li><a href="ios.html">iOS</a></li>
        
            <li><a href="app.html">MacAPP</a></li>
        
            <li><a href="swift.html">Swift</a></li>
        
            <li><a href="js.html">JavaScript</a></li>
        
            <li><a href="vue.html">Vue</a></li>
        
            <li><a href="shell.html">shell</a></li>
        
            <li><a href="%E7%BD%91%E7%BB%9C.html">ç½‘ç»œ</a></li>
         

      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>


        <section id="main-content" role="main" class="scroll-container">
        
       

 <script type="text/javascript">
  $(function(){
    $('#menu_item_index').addClass('is_active');
  });
</script>
<div class="row">
  <div class="large-8 medium-8 columns">
      <div class="markdown-body article-wrap">
       <div class="article">
          
          <h1>Rect-Native ä¹‹ Promise æ·±å…¥æµ…å‡ºä»å…¥é—¨åˆ°ç²¾é€š</h1>
     
        <div class="read-more clearfix">
          <span class="date">2017/12/22</span>

          <span>posted in&nbsp;</span> 
          
              <span class="posted-in"><a href='reactnative.html'>React-Native</a></span>
           
         
          <span class="comments">
            

            
          </span>

        </div>
      </div><!-- article -->

      <div class="article-content">
      <h2 id="toc_0">æ¦‚å¿µç†è§£</h2>

<p><img src="https://ws1.sinaimg.cn/large/006tNc79ly1fhp9dw6vxpj307406ewek.jpg" alt="icon" title="React icon"/></p>

<blockquote>
<p>æ‰€è°“Promiseï¼Œç®€å•è¯´å°±æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œé‡Œé¢ä¿å­˜ç€æŸä¸ªæœªæ¥æ‰ä¼šç»“æŸçš„äº‹ä»¶ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼‰çš„ç»“æœã€‚ä»è¯­æ³•ä¸Šè¯´ï¼ŒPromise æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä»å®ƒå¯ä»¥è·å–å¼‚æ­¥æ“ä½œçš„æ¶ˆæ¯ã€‚</p>
</blockquote>

<span id="more"></span><!-- more -->

<h3 id="toc_1">Promise çŠ¶æ€</h3>

<ul>
<li>Pending è¿›è¡Œä¸­</li>
<li>Resolved å·²å®Œæˆ åˆç§°Fulfilled</li>
<li>Rejected å·²å¤±è´¥</li>
</ul>

<h3 id="toc_2">Promise ç‰¹ç‚¹</h3>

<ul>
<li>å¯¹è±¡çš„çŠ¶æ€ä¸å—å¤–éƒ¨å› ç´ å½±å“ã€‚Promiseå¯¹è±¡ä»£è¡¨çš„æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œåªæœ‰å¼‚æ­¥æ“ä½œçš„ç»“æœèƒ½å†³å®šPromiseçš„çŠ¶æ€ï¼Œä»»ä½•å…¶ä»–æ“ä½œéƒ½ä¸èƒ½å†³å®šå…¶çŠ¶æ€ã€‚</li>
<li>ä¸€æ—¦Promiseæœ‰äº†ç»“æœçŠ¶æ€å°±ä¸ä¼šå†å˜ã€‚<code>Pending==&gt;Resolved</code>,æˆ–è€…<code>Pending==&gt;Rejected</code></li>
</ul>

<h3 id="toc_3">Promise ç¼ºç‚¹</h3>

<p>Promiseçš„ç¼ºç‚¹æ˜¯ï¼šä¸€æ—¦å»ºç«‹å°±ä¼šç«‹å³æ‰§è¡Œï¼Œæ— æ³•ä¸­é€”å–æ¶ˆã€‚</p>

<h2 id="toc_4">Promise åŸºæœ¬ç”¨æ³•</h2>

<pre><code class="language-javascript">var promise = new Promise(function(resolve, reject) {
  // ... some code

  if (/* å¼‚æ­¥æ“ä½œæˆåŠŸ */){
    resolve(value);
  } else {
    reject(error);
  }
});
</code></pre>

<p>Promiseå¯¹è±¡æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ä½“ã€‚<br/>
è¿™ä¸ªå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªæ˜¯resolveï¼Œä¸€ä¸ªæ˜¯rejectã€‚è¿™ä¸¤ä¸ªå‚æ•°æ˜¯Promiseè‡ªåŠ¨æä¾›ï¼Œä¸éœ€è¦ä½¿ç”¨è€…ä¼ å€¼ã€‚</p>

<ul>
<li>resolveå‡½æ•°çš„ä½œç”¨æ˜¯ï¼Œå°†Promiseå¯¹è±¡çš„çŠ¶æ€ä»â€œæœªå®Œæˆâ€å˜ä¸ºâ€œæˆåŠŸâ€ï¼ˆå³ä» Pending å˜ä¸º Resolvedï¼‰ï¼Œåœ¨å¼‚æ­¥æ“ä½œæˆåŠŸæ—¶è°ƒç”¨ï¼Œå¹¶å°†å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œä½œä¸ºå‚æ•°ä¼ é€’å‡ºå»</li>
<li>rejectå‡½æ•°çš„ä½œç”¨æ˜¯ï¼Œå°†Promiseå¯¹è±¡çš„çŠ¶æ€ä»â€œæœªå®Œæˆâ€å˜ä¸ºâ€œå¤±è´¥â€ï¼ˆå³ä» Pending å˜ä¸º Rejectedï¼‰ï¼Œåœ¨å¼‚æ­¥æ“ä½œå¤±è´¥æ—¶è°ƒç”¨ï¼Œå¹¶å°†å¼‚æ­¥æ“ä½œæŠ¥å‡ºçš„é”™è¯¯ï¼Œä½œä¸ºå‚æ•°ä¼ é€’å‡ºå»ã€‚<br/>
Promiseå®ä¾‹ç”Ÿæˆåï¼Œå¯ä»¥ç”¨thenåˆ†åˆ«æŒ‡å®šResolvedå’ŒRejectedçš„å›è°ƒå‡½æ•°ã€‚
<code>JavaScript
promise.then(function(value) {<br/>
// success<br/>
}, function(error) {<br/>
// failure<br/>
});
</code>
thenæ–¹æ³•ä¼šæ¥å—ä¸¤ä¸ªå‚æ•°ï¼š</li>
<li>ç¬¬ä¸€ä¸ªå‡½æ•°ï¼ŒPromiseçŠ¶æ€å˜æ›´ä¸ºResolvedæ—¶è°ƒç”¨ã€‚</li>
<li>ç¬¬äºŒä¸ªå‡½æ•°ï¼ŒPromiseçŠ¶æ€å˜ä¸ºRejectedæ—¶è°ƒç”¨ã€‚å¯é€‰çš„ï¼Œå¯ä»¥ä¸æä¾›ã€‚</li>
</ul>

<p>ä¸‹é¢æ˜¯å¼‚æ­¥åŠ è½½å›¾ç‰‡çš„ä¾‹å­ï¼š</p>

<pre><code class="language-javascript">function loadImageAsync(url) {
  return new Promise(function(resolve, reject) {
    var image = new Image();

    image.onload = function() {
      resolve(image);
    };

    image.onerror = function() {
      reject(new Error(&#39;Could not load image at &#39; + url));
    };

    image.src = url;
  });
}
</code></pre>

<p>ä¸‹é¢æ˜¯Promiseå®ç°çš„Ajaxæ“ä½œçš„ä¾‹å­ï¼š</p>

<pre><code class="language-javascript">var getJSON = function(url) {
  var promise = new Promise(function(resolve, reject){
    var client = new XMLHttpRequest();
    client.open(&quot;GET&quot;, url);
    client.onreadystatechange = handler;
    client.responseType = &quot;json&quot;;
    client.setRequestHeader(&quot;Accept&quot;, &quot;application/json&quot;);
    client.send();
    function handler() {
      if (this.readyState !== 4) {
        return;
      }
      if (this.status === 200) {
        resolve(this.response);
      } else {
        reject(new Error(this.statusText));
      }
    };
  });

  return promise;
};

getJSON(&quot;/posts.json&quot;).then(function(json) {
  console.log(&#39;Contents: &#39; + json);
}, function(error) {
  console.error(&#39;å‡ºé”™äº†&#39;, error);
});
</code></pre>

<p><strong>æ³¨æ„ï¼šåœ¨getJSONå†…éƒ¨ï¼Œresolveå‡½æ•°å’Œrejectå‡½æ•°è°ƒç”¨æ—¶ï¼Œéƒ½å¸¦æœ‰å‚æ•°ï¼ï¼</strong><br/><br/>
    å¦‚æœè°ƒç”¨resolveå‡½æ•°å’Œrejectå‡½æ•°æ—¶å¸¦æœ‰å‚æ•°ï¼Œé‚£ä¹ˆå®ƒä»¬çš„å‚æ•°ä¼šè¢«ä¼ é€’ç»™å›è°ƒå‡½æ•°ã€‚</p>

<ul>
<li>rejectå‡½æ•°çš„å‚æ•°é€šå¸¸æ˜¯Errorå¯¹è±¡çš„å®ä¾‹ï¼Œè¡¨ç¤ºæŠ›å‡ºçš„é”™è¯¯</li>
<li>resolveå‡½æ•°çš„å‚æ•°é™¤äº†æ­£å¸¸çš„å€¼ä»¥å¤–ï¼Œè¿˜å¯èƒ½æ˜¯å¦ä¸€ä¸ª Promise å®ä¾‹ï¼Œè¡¨ç¤ºå¼‚æ­¥æ“ä½œçš„ç»“æœæœ‰å¯èƒ½æ˜¯ä¸€ä¸ªå€¼ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯å¦ä¸€ä¸ªå¼‚æ­¥æ“ä½œ</li>
</ul>

<pre><code class="language-javascript">var p1 = new Promise(function (resolve, reject) {
  // ...
});

var p2 = new Promise(function (resolve, reject) {
  // ...
  resolve(p1);
})
</code></pre>

<p>ä¸Šé¢ğŸ‘†ï¼Œ<code>p1</code>ã€<code>p2</code> éƒ½æ˜¯Promiseï¼Œä½†æ˜¯<code>p2</code>çš„resolveæŠŠ<code>p1</code>ä½œä¸ºè¿”å›å€¼å‚æ•°ä¼ å‡ºå»äº†ï¼Œå³ä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„è¿”å›ç»“æœæ˜¯å¦ä¸€ä¸ªå¼‚æ­¥æ“ä½œã€‚ï¼ˆç±»ä¼¼äºiOSå¼€å‘ä¸­çš„è‡ªåŠ¨å¸ƒå±€åº“ <code>Masonry</code>,å¯ä»¥æ— é™ç‚¹è¯­æ³•å–åˆ°å¯¹è±¡ï¼‰ã€‚<br/><br/>
<strong>æ³¨æ„ï¼šæ­¤æ—¶ï¼Œp1çš„çŠ¶æ€ä¼šä¼ é€’p2.å¦‚æœp1æ˜¯PendingçŠ¶æ€,é‚£ä¹ˆp2ä¼šç­‰å¾…p1çš„ç»“æœã€‚å¦‚æœp1æ˜¯Rejectæˆ–è€…ResolveçŠ¶æ€ï¼Œé‚£ä¹ˆp2çš„å›è°ƒå‡½æ•°å°†ä¼šç«‹å³æ‰§è¡Œã€‚</strong></p>

<p><strong>å†çœ‹:</strong></p>

<pre><code class="language-javascript">var p1 = new Promise(function (resolve, reject) {
  setTimeout(() =&gt; reject(new Error(&#39;fail&#39;)), 3000)
})

var p2 = new Promise(function (resolve, reject) {
  setTimeout(() =&gt; resolve(p1), 1000)
})

p2.then(result =&gt; console.log(result))
  .catch(error =&gt; console.log(error))
// Error: fail
</code></pre>

<ol>
<li><code>p1</code>ä¼šåœ¨3ç§’åæŠ›å‡ºerrorã€‚<br/></li>
<li><code>p2</code>ä¼šåœ¨1ç§’åæ”¹å˜çŠ¶æ€ã€‚Resolvçš„è¿”å›å€¼æ˜¯<code>p1</code>.<br/></li>
<li>ç”±äº<code>p2</code>çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªPromiseï¼Œå¯¼è‡´<code>p2</code>è‡ªå·±çš„çŠ¶æ€æ— æ•ˆäº†ï¼Œæ­¤æ—¶<code>p2</code>çš„çŠ¶æ€å–å†³äº<code>p1</code>.<br/></li>
<li>æ‰€ä»¥ï¼Œåé¢çš„thenè¯­å¥ï¼Œéƒ½å˜æˆé’ˆå¯¹p1çš„äº†ã€‚<br/></li>
<li>åˆè¿‡äº†<code>2ç§’</code>ï¼Œ<code>p1</code>å˜ä¸º<code>reject</code>ï¼Œå¯¼è‡´è§¦å‘<code>catch</code>æ–¹æ³•ã€‚<br/></li>
</ol>

<h2 id="toc_5">3. Promise.prototype.then()</h2>

<p><strong>thenæ–¹æ³•æ˜¯å®šä¹‰åœ¨åŸå‹å¯¹è±¡Promise.prototypeä¸Šçš„ã€‚</strong><br/>
ä½œç”¨ï¼šä¸ºPromiseå¯¹è±¡æ·»åŠ çŠ¶æ€æ”¹å˜æ—¶çš„å›è°ƒå‡½æ•°ã€‚ç¬¬ä¸€ä¸ªæ˜¯Resolvedï¼Œç¬¬äºŒä¸ªæ˜¯Rejectedã€‚<br/>
thenæ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªæ–°çš„Promiseå¯¹è±¡ï¼Œä¸æ˜¯ä¹‹å‰çš„å®ä¾‹ã€‚å› æ­¤ thenæ–¹æ³•åé¢è¿˜å¯ä»¥å†å†™ä¸€ä¸ªthenæ–¹æ³•,å³é“¾å¼è°ƒç”¨ã€‚</p>

<pre><code class="language-javascript">getJSON(&quot;/posts.json&quot;).then(function(json) {
  return json.post;
}).then(function(post) {
  // ...
});
</code></pre>

<p>ç¬¬ä¸€ä¸ªå›è°ƒå‡½æ•°å®Œæˆä»¥åï¼Œä¼šå°†è¿”å›ç»“æœä½œä¸ºå‚æ•°ï¼Œä¼ å…¥ç¬¬äºŒä¸ªå›è°ƒå‡½æ•°ã€‚</p>

<pre><code class="language-javascript">getJSON(&quot;/post/1.json&quot;).then(function(post) {
  return getJSON(post.commentURL);
}).then(function funcA(comments) {
  console.log(&quot;Resolved: &quot;, comments);
}, function funcB(err){
  console.log(&quot;Rejected: &quot;, err);
});
</code></pre>

<p>ç¬¬ä¸€ä¸ªthenå‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªæ–°çš„Promiseå¯¹è±¡ã€‚äºæ˜¯æ‰èƒ½ç»§ç»­è°ƒç”¨thenæ–¹æ³•ã€‚<br/>
ç¬¬äºŒä¸ªthenæ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ï¼Œå°±ä¼šç­‰å¾…è¿™ä¸ªPromiseå¯¹è±¡çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œresolvä¼šè°ƒç”¨funcA,rejectä¼šè°ƒç”¨funcB.</p>

<p>ä¸‹é¢ğŸ‘‡æ˜¯ç®­å¤´å‡½æ•°çš„å®ç°ï¼Œä¼šæ›´ç®€æ´ï¼š</p>

<pre><code class="language-javascript">getJSON(&quot;/post/1.json&quot;).then(
  post =&gt; getJSON(post.commentURL)
).then(
  comments =&gt; console.log(&quot;Resolved: &quot;, comments),
  err =&gt; console.log(&quot;Rejected: &quot;, err)
);
</code></pre>

<h2 id="toc_6">4. Promise.prototype.catch()</h2>

<h3 id="toc_7">Promise.prototype.catchæ–¹æ³•æ˜¯.then(null, rejection)çš„åˆ«åï¼Œç”¨äºæŒ‡å®šå‘ç”Ÿé”™è¯¯æ—¶çš„å›è°ƒå‡½æ•°</h3>

<p><strong>Promise.prototype.catchæ–¹æ³•æ˜¯.then(null, rejection)çš„åˆ«åï¼Œç”¨äºæŒ‡å®šå‘ç”Ÿé”™è¯¯æ—¶çš„å›è°ƒå‡½æ•°.</strong>    </p>

<pre><code class="language-javascript">getJSON(&#39;/posts.json&#39;).then(function(posts) {
  // ...
}).catch(function(error) {
  // å¤„ç† getJSON å’Œ å‰ä¸€ä¸ªå›è°ƒå‡½æ•°è¿è¡Œæ—¶å‘ç”Ÿçš„é”™è¯¯
  console.log(&#39;å‘ç”Ÿé”™è¯¯ï¼&#39;, error);
});
</code></pre>

<p>getJSON()æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªPromiseå¯¹è±¡ã€‚å¦‚æœresolvï¼Œä¼šè°ƒç”¨thenæ–¹æ³•ï¼›å¦‚æœrejectåˆ™ä¼šè°ƒç”¨catchæ–¹æ³•ã€‚</p>

<h3 id="toc_8">thenæ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ï¼Œå¦‚æœè¿è¡Œä¸­æŠ›å‡ºé”™è¯¯ï¼Œä¹Ÿä¼šè¢«catchæ–¹æ³•æ•è·</h3>

<p><strong>å¦å¤–ï¼Œthenæ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ï¼Œå¦‚æœè¿è¡Œä¸­æŠ›å‡ºé”™è¯¯ï¼Œä¹Ÿä¼šè¢«catchæ–¹æ³•æ•è·</strong>   </p>

<pre><code class="language-javascript">p.then((val) =&gt; console.log(&#39;fulfilled:&#39;, val))
  .catch((err) =&gt; console.log(&#39;rejected&#39;, err));

// ç­‰åŒäº
p.then((val) =&gt; console.log(&#39;fulfilled:&#39;, val))
  .then(null, (err) =&gt; console.log(&quot;rejected:&quot;, err));
</code></pre>

<pre><code class="language-text">var promise = new Promise(function(resolve, reject) {
  throw new Error(&#39;test&#39;);
});
promise.catch(function(error) {
  console.log(error);
});
// Error: test
</code></pre>

<p>Promiseå¯¹è±¡Resolvedï¼Œä½†æ˜¯ResolvedæŒ‡å®šçš„æ–¹æ³•è·‘å‡ºé”™è¯¯ã€‚<br/>
Promiseå¯¹è±¡catchæ–¹æ³•èƒ½æ•è·è·‘å‡ºçš„errorã€‚</p>

<h3 id="toc_9">rejectæ–¹æ³•ç­‰åŒäºæŠ›å‡ºé”™è¯¯</h3>

<p>ä¸Šé¢çš„å†™æ³•è·Ÿä¸‹é¢çš„ä¸¤ç§å†™æ³•æ˜¯ä¸€æ ·çš„ï¼š</p>

<pre><code class="language-text">// å†™æ³•ä¸€
var promise = new Promise(function(resolve, reject) {
  try {
    throw new Error(&#39;test&#39;);
  } catch(e) {
    reject(e);
  }
});
promise.catch(function(error) {
  console.log(error);
});

// å†™æ³•äºŒ
var promise = new Promise(function(resolve, reject) {
  reject(new Error(&#39;test&#39;));
});
promise.catch(function(error) {
  console.log(error);
});
</code></pre>

<p><strong>ç”±æ­¤å¯è§ï¼šrejectæ–¹æ³•ç­‰åŒäºæŠ›å‡ºé”™è¯¯ã€‚</strong></p>

<h3 id="toc_10">resolveä¹‹ååœ¨æŠ›å‡ºé”™è¯¯ï¼Œcatchæ˜¯æ•è·ä¸åˆ°çš„ä¸åˆ°çš„ã€‚</h3>

<pre><code class="language-text">var promise = new Promise(function(resolve, reject) {
  resolve(&#39;ok&#39;);
  throw new Error(&#39;test&#39;);
});
promise
  .then(function(value) { console.log(value) })
  .catch(function(error) { console.log(error) });
// ok
</code></pre>

<p><strong>resolveä¹‹ååœ¨æŠ›å‡ºé”™è¯¯ï¼Œcatchæ˜¯æ•è·ä¸åˆ°çš„ä¸åˆ°çš„ã€‚</strong></p>

<h3 id="toc_11">Promise å¯¹è±¡çš„é”™è¯¯å…·æœ‰â€œå†’æ³¡â€æ€§è´¨</h3>

<p><strong>Promise å¯¹è±¡çš„é”™è¯¯å…·æœ‰â€œå†’æ³¡â€æ€§è´¨,ä¼šä¸€ç›´å‘åä¼ é€’ï¼Œç›´åˆ°è¢«æ•è·ä¸ºæ­¢ ------ é”™è¯¯æ€»æ˜¯ä¼šè¢«ä¸‹ä¸€ä¸ªcatchè¯­å¥æ•è·</strong></p>

<blockquote>
<p>ä¸¾ä¸ªæ —å­ï¼šå°±åƒæ˜¯YæŸ“è‰²ä½“ä¸Šå—ç¯å¢ƒè§¦å‘çš„é—ä¼ ç–¾ç—…ï¼Œä¼šä¸æ–­çš„é—ä¼ ç»™ç”·æ€§åä»£ï¼Œä»»æ„ä¸€ä¸ªç”·æ€§éƒ½ä¼šè¢«ç‰¹æ®Šçš„ç¯å¢ƒè§¦å‘ã€‚</p>
</blockquote>

<pre><code class="language-text">getJSON(&#39;/post/1.json&#39;).then(function(post) {
  return getJSON(post.commentURL);
}).then(function(comments) {
  // some code
}).catch(function(error) {
  // å¤„ç†å‰é¢ä¸‰ä¸ªPromiseäº§ç”Ÿçš„é”™è¯¯
});
</code></pre>

<p>ä¸Šè¿°ä»£ç ä¸­æœ‰ä¸‰ä¸ªPromiseï¼Œç¬¬ä¸€ä¸ªç”±getJSONäº§ç”Ÿï¼Œåä¸¤ä¸ªç”±thenäº§ç”Ÿã€‚ä»–ä»¬ä¹‹ä¸­çš„ä»»ä½•ä¸€ä¸ªæŠ›å‡ºé”™è¯¯ï¼Œéƒ½ä¼šè¢«catchæ•è·ã€‚</p>

<p>ä¸€èˆ¬æ¥è®²ï¼Œå°½é‡ä¸è¦å®šä¹‰Promiseçš„rejectçŠ¶æ€çš„å›è°ƒå‡½æ•°ï¼Œæœ€å¥½æ€»æ˜¯ä½¿ç”¨catchå‡½æ•°ï¼Œå› ä¸ºcatchå‡½æ•°ä¸ä»…èƒ½æ•è·åˆ°rejectçŠ¶æ€ï¼Œè¿˜èƒ½æ•è·åˆ°resolveçŠ¶æ€æŒ‡å®šæ–¹æ³•ä¸‹æŠ›å‡ºçš„å¼‚å¸¸ã€‚</p>

<h3 id="toc_12">Promiseå¯¹è±¡æŠ›å‡ºçš„é”™è¯¯ä¸ä¼šä¼ é€’åˆ°å¤–å±‚ä»£ç </h3>

<p>å¦‚æœæ²¡æœ‰ä½¿ç”¨catchæ–¹æ³•æŒ‡å®šé”™è¯¯å¤„ç†çš„å›è°ƒå‡½æ•°ï¼ŒPromiseå¯¹è±¡æŠ›å‡ºçš„é”™è¯¯ä¸ä¼šä¼ é€’åˆ°å¤–å±‚ä»£ç ï¼Œå³ä¸ä¼šæœ‰ä»»ä½•ååº”ï¼Œè¿™ä¸€ç‚¹ä¸Šè·Ÿä¼ ç»Ÿçš„try/catchä»£ç å—ä¸åŒçš„ã€‚</p>

<pre><code class="language-text">process.on(&#39;unhandledRejection&#39;, function (err, p) {
  console.error(err.stack)
});
</code></pre>

<p>æ—¶é—´çš„ç›‘å¬å‡½æ•°â€˜unhandledRejectionâ€™,æœ‰ä¸¤ä¸ªå‚æ•°ï¼š<br/>
ç¬¬ä¸€ä¸ªæ˜¯é”™è¯¯å¯¹è±¡<br/>
ç¬¬äºŒä¸ªæ˜¯æŠ¥é”™çš„Promiseå®ä¾‹</p>

<p>catchæ–¹æ³•è¿”å›çš„ä¹Ÿæ˜¯ä¸€ä¸ªPromiseå®ä¾‹ï¼Œæ‰€ä»¥åé¢è¿˜æ˜¯å¯ä»¥æ— é™çš„è°ƒç”¨thenæ–¹æ³•ã€‚<br/>
å¦‚æœcatchå‡½æ•°åœ¨å‡ ä¸ªthenä¸­é—´ï¼ŒäºŒæ‰§è¡Œè¿‡ç¨‹ä¸­éƒ½æ²¡æœ‰rejectçŠ¶æ€ï¼Œé‚£ä¹ˆä¼šè·³è¿‡è¿™ä¸ªä¸­é—´çš„catchæ–¹æ³•ã€‚</p>

<h3 id="toc_13">catchæ–¹æ³•ä¸­ä¹Ÿèƒ½æŠ›å‡ºé”™è¯¯</h3>

<pre><code class="language-text">var someAsyncThing = function() {
  return new Promise(function(resolve, reject) {
    // ä¸‹é¢ä¸€è¡Œä¼šæŠ¥é”™ï¼Œå› ä¸ºxæ²¡æœ‰å£°æ˜
    resolve(x + 2);
  });
};

someAsyncThing().then(function() {
  return someOtherAsyncThing();
}).catch(function(error) {
  console.log(&#39;oh no&#39;, error);
  // ä¸‹é¢ä¸€è¡Œä¼šæŠ¥é”™ï¼Œå› ä¸ºyæ²¡æœ‰å£°æ˜
  y + 2;
}).then(function() {
  console.log(&#39;carry on&#39;);
});
// oh no [ReferenceError: x is not defined]
</code></pre>

<p>å¦‚ä¸Šï¼šcatchæ–¹æ³•æŒ‡å®šçš„å‡½æ•°ä¾æ—§æ˜¯å¯ä»¥æŠ›å‡ºErrorçš„ï¼Œä½†æ˜¯å› ä¸ºåé¢æ²¡æœ‰ç»§ç»­è·Ÿè¿›catchæ–¹æ³•ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰è¢«æ•è·ã€‚</p>

<h2 id="toc_14">5. Promise.all()</h2>

<p><strong>Promise.allæ–¹æ³•ç”¨äºå°†å¤šä¸ª Promise å®ä¾‹ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ã€‚</strong></p>

<pre><code class="language-text">var p = Promise.all([p1, p2, p3]);
</code></pre>

<p>Promise.allæ–¹æ³•æ¥å—ä¸€ä¸ªæ•°ç»„ä½œä¸ºå‚æ•°ï¼Œp1ã€p2ã€p3éƒ½æ˜¯ Promise å®ä¾‹ï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±ä¼šå…ˆè°ƒç”¨ä¸‹é¢è®²åˆ°çš„Promise.resolveæ–¹æ³•ï¼Œå°†å‚æ•°è½¬ä¸º Promise å®ä¾‹ï¼Œå†è¿›ä¸€æ­¥å¤„ç†ã€‚<br/>
ï¼ˆPromise.allæ–¹æ³•çš„å‚æ•°å¯ä»¥ä¸æ˜¯æ•°ç»„ï¼Œä½†å¿…é¡»å…·æœ‰ Iterator æ¥å£ï¼Œä¸”è¿”å›çš„æ¯ä¸ªæˆå‘˜éƒ½æ˜¯ Promise å®ä¾‹ã€‚ï¼‰</p>

<p>pçš„çŠ¶æ€ç”±p1ã€p2ã€p3å†³å®šï¼Œåˆ†æˆä¸¤ç§æƒ…å†µ:</p>

<ul>
<li>åªæœ‰p1ã€p2ã€p3çš„çŠ¶æ€éƒ½å˜æˆfulfilledï¼Œpçš„çŠ¶æ€æ‰ä¼šå˜æˆfulfilledï¼Œæ­¤æ—¶p1ã€p2ã€p3çš„è¿”å›å€¼ç»„æˆä¸€ä¸ªæ•°ç»„ï¼Œä¼ é€’ç»™pçš„å›è°ƒå‡½æ•°</li>
<li>åªè¦p1ã€p2ã€p3ä¹‹ä¸­æœ‰ä¸€ä¸ªè¢«rejectedï¼Œpçš„çŠ¶æ€å°±å˜æˆrejectedï¼Œæ­¤æ—¶ç¬¬ä¸€ä¸ªè¢«rejectçš„å®ä¾‹çš„è¿”å›å€¼ï¼Œä¼šä¼ é€’ç»™pçš„å›è°ƒå‡½æ•°</li>
</ul>

<p><strong>æ³¨æ„ï¼Œå¦‚æœä½œä¸ºå‚æ•°çš„ Promise å®ä¾‹ï¼Œè‡ªå·±å®šä¹‰äº†catchæ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒä¸€æ—¦è¢«rejectedï¼Œå¹¶ä¸ä¼šè§¦å‘Promise.all()çš„catchæ–¹æ³•ã€‚</strong></p>

<pre><code class="language-text">const p1 = new Promise((resolve, reject) =&gt; {
  resolve(&#39;hello&#39;);
})
.then(result =&gt; result)
.catch(e =&gt; e);

const p2 = new Promise((resolve, reject) =&gt; {
  throw new Error(&#39;æŠ¥é”™äº†&#39;);
})
.then(result =&gt; result)
.catch(e =&gt; e);

Promise.all([p1, p2])
.then(result =&gt; console.log(result))
.catch(e =&gt; console.log(e));
// [&quot;hello&quot;, Error: æŠ¥é”™äº†]
</code></pre>

<p>p1ä¼šresolvedï¼Œp2é¦–å…ˆä¼šrejected.<br/>
p2æœ‰è‡ªå·±çš„catchæ–¹æ³•ï¼Œå¹¶ä¸”æ‰§è¡Œäº†ï¼Œé‚£ä¹ˆå°±ä¼šè¿”å›ä¸€ä¸ªæ–°çš„Promiseï¼Œå¹¶ä¸”è¿™ä¸ªPromiseçš„çŠ¶æ€ä¼šå˜æˆResolvedã€‚<br/>
æ‰€ä»¥ï¼šPromise.all()çš„catchæ–¹æ³•å¹¶ä¸èƒ½æ•è·åˆ°è¿™ä¸ªerrorã€‚<br/>
p2æ²¡æœ‰è‡ªå·±çš„catchæ–¹æ³•ï¼Œæ‰€ä»¥ä¼šè°ƒç”¨Promise.all()çš„catchæ–¹æ³•ã€‚</p>

<h2 id="toc_15">6. Promise.race()</h2>

<p>Promise.raceæ–¹æ³•åŒæ ·æ˜¯å°†å¤šä¸ªPromiseå®ä¾‹ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„Promiseå®ä¾‹ã€‚</p>

<pre><code class="language-text">var p = Promise.race([p1, p2, p3]);
</code></pre>

<p>p1/p2/p3ä¸­åªè¦æœ‰ä¸€ä¸ªç‡å…ˆæ”¹å˜çŠ¶æ€ï¼Œpçš„çŠ¶æ€å°±ä¼šéšç€æ”¹å˜ã€‚é‚£ä¸ªç‡å…ˆæ”¹å˜çŠ¶æ€çš„å®ä¾‹çš„è¿”å›å€¼ï¼Œå°±ä¼šä¼ é€’ç»™pçš„å›è°ƒå‡½æ•°ã€‚</p>

<pre><code class="language-text">const p = Promise.race([
  fetch(&#39;/resource-that-may-take-a-while&#39;),
  new Promise(function (resolve, reject) {
    setTimeout(() =&gt; reject(new Error(&#39;request timeout&#39;)), 5000)
  })
]);
p.then(response =&gt; console.log(response));
p.catch(error =&gt; console.log(error));
</code></pre>

<p>5ç§’å†…æ— æ³•è¿”å›è¯·æ±‚ç»“æœï¼Œå˜é‡pçš„çŠ¶æ€å°±ä¼šå˜ä¸ºrejectã€‚è¿™ä¹Ÿç®—æ˜¯ç«é€Ÿçš„ä¸€ç§åº”ç”¨åœºæ™¯ã€‚</p>

<h2 id="toc_16">7. Promise.resolve()</h2>

<p>æœ‰æ—¶éœ€è¦å°†ç°æœ‰å¯¹è±¡è½¬ä¸ºPromiseå¯¹è±¡ï¼ŒPromise.resolveæ–¹æ³•å°±èµ·åˆ°è¿™ä¸ªä½œç”¨.</p>

<pre><code class="language-text">var jsPromise = Promise.resolve($.ajax(&#39;/whatever.json&#39;));
</code></pre>

<p>ç­‰ä»·äºä¸‹é¢çš„è¯´æ³•ï¼š</p>

<pre><code class="language-text">Promise.resolve(&#39;foo&#39;)
// ç­‰ä»·äº
new Promise(resolve =&gt; resolve(&#39;foo&#39;))
</code></pre>

<p>Promise çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªç®­å¤´å‡½æ•°ï¼Œå‡½æ•°çš„ä¼ å…¥å‚æ•°æ˜¯resolveï¼ˆå‡½æ•°ï¼‰ï¼Œå‡½æ•°ä½“å°±æ˜¯è°ƒç”¨ä¼ å…¥çš„å‡½æ•°resolveï¼Œresolveè°ƒç”¨çš„æ—¶å€™ï¼Œä¹Ÿéœ€è¦ä¸€ä¸ªå‚æ•°ï¼Œæ­¤æ—¶è¿™ä¸ªå‚æ•°å°±æ˜¯å’±ä»¬éœ€è¦è½¬å˜æˆPromiseå¯¹è±¡çš„é‚£ä¸ªå‚æ•°ã€‚</p>

<p>Promise.resolveçš„å‚æ•°æœ‰å››ç§æƒ…å†µï¼š</p>

<ol>
<li>å‚æ•°æ˜¯ä¸€ä¸ªPromiseå®ä¾‹</li>
<li>å‚æ•°æ˜¯ä¸€ä¸ªthenableå¯¹è±¡ï¼ˆæœ‰thenæ–¹æ³•çš„å®ä¾‹ï¼‰</li>
<li>å‚æ•°æ˜¯ä¸å…·å¤‡thenæ–¹æ³•dçš„å¯¹è±¡åº”è¯¥</li>
<li>ä¸å¸¦å‚æ•°ï¼Œè¿”å›ä¸€ä¸ªResolvedçš„è¿”å›çŠ¶æ€ã€‚</li>
</ol>

<h2 id="toc_17">8ã€Promise.reject()   åŒä¸Š</h2>

<h2 id="toc_18">9ã€ä¸¤ä¸ªå¸¸ç”¨é™„åŠ æ–¹æ³•</h2>

<h3 id="toc_19">done()</h3>

<p>Promiseçš„é”™è¯¯å¹¶ä¸ä¼šå†’æ³¡åˆ°å…¨å±€ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æä¾›ä¸€ä¸ªdoneæ–¹æ³•æ€»æ˜¯å¤„äºä¼šåŠé“¾çš„å°¾ç«¯ã€‚</p>

<pre><code class="language-text">asyncFunc()
  .then(f1)
  .catch(r1)
  .then(f2)
  .done();
  ```
  
doneæ–¹æ³•çš„ä½¿ç”¨ï¼Œå¯ä»¥åƒthenæ–¹æ³•é‚£æ ·ç”¨ï¼Œæä¾›Fulfilledå’ŒRejectedçŠ¶æ€çš„å›è°ƒå‡½æ•°ï¼Œä¹Ÿå¯ä»¥ä¸æä¾›ä»»ä½•å‚æ•°ã€‚ä½†ä¸ç®¡æ€æ ·ï¼Œdoneéƒ½ä¼šæ•æ‰åˆ°ä»»ä½•å¯èƒ½å‡ºç°çš„é”™è¯¯ï¼Œå¹¶å‘å…¨å±€æŠ›å‡º.

### finally()
finallyæ–¹æ³•ç”¨äºæŒ‡å®šä¸ç®¡Promiseå¯¹è±¡æœ€åçŠ¶æ€å¦‚ä½•ï¼Œéƒ½ä¼šæ‰§è¡Œçš„æ“ä½œã€‚å®ƒä¸doneæ–¹æ³•çš„æœ€å¤§åŒºåˆ«ï¼Œå®ƒæ¥å—ä¸€ä¸ªæ™®é€šçš„å›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°ä¸ç®¡æ€æ ·éƒ½å¿…é¡»æ‰§è¡Œã€‚

</code></pre>

<p>Promise.prototype.finally = function (callback) {<br/>
  let P = this.constructor;<br/>
  return this.then(<br/>
    value  =&gt; P.resolve(callback()).then(() =&gt; value),<br/>
    reason =&gt; P.resolve(callback()).then(() =&gt; { throw reason })<br/>
  );<br/>
};</p>

<pre><code class="language-text">
### Promis.try()

</code></pre>

<p>try {<br/>
  database.users.get({id: userId})<br/>
  .then(...)<br/>
  .catch(...)<br/>
} catch (e) {<br/>
  // ...<br/>
}</p>

<pre><code class="language-text">
</code></pre>

<p>Promise.try(database.users.get({id: userId}))<br/>
  .then(...)<br/>
  .catch(...)</p>

<pre><code class="language-text">
Promise.tryå°±æ˜¯æ¨¡æ‹Ÿtryä»£ç å—ï¼Œå°±åƒpromise.catchæ¨¡æ‹Ÿçš„æ˜¯catchä»£ç å—.

</code></pre>


    

      </div>

      <div class="row">
        <div class="large-6 columns">
        <p class="text-left" style="padding:15px 0px;">
      
          <a href="15151216159291.html" 
          title="Previous Post: ">&laquo; </a>
      
        </p>
        </div>
        <div class="large-6 columns">
      <p class="text-right" style="padding:15px 0px;">
      
          <a  href="15137645005542.html" 
          title="Next Post: ES6 ç¬”è®°ï¼ˆArrayï¼‰">ES6 ç¬”è®°ï¼ˆArrayï¼‰ &raquo;</a>
      
      </p>
        </div>
      </div>
      <div class="comments-wrap">
        <div class="share-comments">
          

          

          
        </div>
      </div>
    </div><!-- article-wrap -->
  </div><!-- large 8 -->




 <div class="large-4 medium-4 columns">
  <div class="hide-for-small">
    <div id="sidebar" class="sidebar">
          <div id="site-info" class="site-info">
            
                <div class="site-a-logo"><img src="https://ws1.sinaimg.cn/large/006tNc79ly1fmpk9088gsj30sg0sgn33.jpg" /></div>
            
                <h1>kaelinda</h1>
                <div class="site-des">å€˜è‹¥æˆ‘å¿ƒä¸­çš„å±±æ°´ï¼Œä½ çœ¼ä¸­èƒ½çœ‹åˆ°ï¼Œæˆ‘ä¾¿ä¸€æ­¥ä¸€è²èŠ±ç¥ˆç¥·</div>
                <div class="social">








<a target="_blank" class="twitter" target="_blank" href="https://twitter.com/KaelLVLinda" title="Twitter">Twitter</a>
<a target="_blank" class="github" target="_blank" href="https://github.com/Kaelzzs" title="GitHub">GitHub</a>
<a target="_blank" class="email" href="mailto:zhouzuosong_kael@163.com" title="Email">Email</a>
  <a target="_blank" class="rss" href="atom.xml" title="RSS">RSS</a>
                
              	 </div>
          	</div>

             

              <div id="site-categories" class="side-item ">
                <div class="side-header">
                  <h2>Categories</h2>
                </div>
                <div class="side-content">

      	<p class="cat-list">
        
            <a href="reactnative.html"><strong>React-Native</strong></a>
        
            <a href="ios.html"><strong>iOS</strong></a>
        
            <a href="app.html"><strong>MacAPP</strong></a>
        
            <a href="swift.html"><strong>Swift</strong></a>
        
            <a href="js.html"><strong>JavaScript</strong></a>
        
            <a href="vue.html"><strong>Vue</strong></a>
        
            <a href="shell.html"><strong>shell</strong></a>
        
            <a href="%E7%BD%91%E7%BB%9C.html"><strong>ç½‘ç»œ</strong></a>
         
        </p>


                </div>
              </div>

              <div id="site-categories" class="side-item">
                <div class="side-header">
                  <h2>Recent Posts</h2>
                </div>
                <div class="side-content">
                <ul class="posts-list">
	      
		      
			      <li class="post">
			        <a href="15523077857608.html">OCä¸­æšä¸¾å†™æ³•  ä»¥åŠ å­—ç¬¦ä¸²æšä¸¾æ¢ç´¢</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15522686353535.html">iOS åŠ¨ç”»å…¨è§£ (1)</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15501356584731.html">UITableViewé¡¶éƒ¨ç©ºç™½çš„å‡ ç§è§£å†³åŠæ³•</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15409691048860.html">ã€Swiftç¬”è®°ã€‘å¼•ç”¨è®¡æ•°</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15402889434646.html">Swiftä¸­ç±»ï¼ˆClassï¼‰å’Œ ç»“æ„ä½“ï¼ˆStructï¼‰</a>
			      </li>
		     
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		   
		  		</ul>
                </div>
              </div>
        </div><!-- sidebar -->
      </div><!-- hide for small -->
</div><!-- large 4 -->

</div><!-- row -->

 <div class="page-bottom clearfix">
  <div class="row">
   <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
</div>

        </section>
      </div>
    </div>

  
    

    <script src="asset/js/foundation.min.js"></script>
    <script>
      $(document).foundation();
      function fixSidebarHeight(){
        var w1 = $('.markdown-body').height();
          var w2 = $('#sidebar').height();
          if (w1 > w2) { $('#sidebar').height(w1); };
      }
      $(function(){
        fixSidebarHeight();
      })
      $(window).load(function(){
          fixSidebarHeight();
      });
     
    </script>

    
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({TeX: { equationNumbers: { autoNumber: "AMS" } }});</script>


  </body>
</html>
