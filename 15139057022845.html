<!doctype html>
<html lang="zh-cn">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,minimum-scale=1" />
    <title>
        
      Rect-Native ä¹‹ Promise æ·±å…¥æµ…å‡ºä»å…¥é—¨åˆ°ç²¾é€š - Kaelinda
      
    </title>
    <meta name="keywords" content="Kaelinda" />
    
      <meta name="twitter:card" content="summary_large_image" />
      <meta name="twitter:creator" content="@" />
      <meta property="og:url" content="http://kaelinda.top/15139057022845.html" />
      <meta property="og:title" content="Rect-Native ä¹‹ Promise æ·±å…¥æµ…å‡ºä»å…¥é—¨åˆ°ç²¾é€š" />
      
        <meta property="og:description" content="Rect-Native ä¸­é’ˆå¯¹ Promiseçš„ç†è§£å’Œæ¢ç´¢" />
        <meta name="description" content="Rect-Native ä¸­é’ˆå¯¹ Promiseçš„ç†è§£å’Œæ¢ç´¢" />
      
      
      <meta property="og:site_name" content="Kaelinda" />
    
    
    <link href="atom.xml" rel="alternate" title="Kaelinda" type="application/atom+xml">
    <script src="https://cdn.bootcss.com/moment.js/2.24.0/moment.min.js"></script>
    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <!--Global site tag (gtag.js) - Google Analytics>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="asset/style.css">
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  </head>
  <body>
    <script src="asset/colorscheme.js"></script>
    <div class="container">
      <div class="head">
        <div class="row">
          <div class="col-md-12">
            <div class="blogname">Kaelinda</div>
            <nav>
              
                <div class="item"><a target="_self" href="index.html">æœ€è¿‘æ›´æ–°</a></div>
              
                <div class="item"><a target="_self" href="archives.html">å½’æ¡£ç›®å½•</a></div>
              
                <div class="item"><a target="_self" href="ios.html">iOS</a></div>
              
                <div class="item"><a target="_self" href="swift.html">Swift</a></div>
              
                <div class="item"><a target="_self" href="reactnative.html">RN</a></div>
              
                <div class="item"><a target="_self" href="js.html">JS</a></div>
              
                <div class="item"><a target="_self" href="shell.html">shell</a></div>
              
                <div class="item"><a target="_self" href="py.html">Python</a></div>
              
            </nav>
          </div>
        </div>
      </div>
      <hr>
    </div> <div class="container" id="post">
  <div class="article huge">
    <div class="featureimg" style="background-image: url('asset/defaultfeaimg.jpg')"></div>
    <img src="" style="display: none;" class="featureimgforexternal">
    <div class="timeGTM" style="display:none;">2017-12-22T09:21:42+08:00</div>
    <div class="row content">
      <div class="col-md-2"></div>
      <div class="col-md-10 main">
        <div class="row">
          <div class="col-md-10">
            <div class="post">
              <div class="headline"><a href="15139057022845.html">Rect-Native ä¹‹ Promise æ·±å…¥æµ…å‡ºä»å…¥é—¨åˆ°ç²¾é€š</a></div>
              <div class="subtitle">Rect-Native ä¸­é’ˆå¯¹ Promiseçš„ç†è§£å’Œæ¢ç´¢</div>
              <div class="meta"><span class="time">$[timeformat('2017-12-22T09:21:42+08:00')]</span><br><span class="tags"></span></div>
              <div class="body">
                  <h2><a id="%E6%A6%82%E5%BF%B5%E7%90%86%E8%A7%A3" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>æ¦‚å¿µç†è§£</h2>
<p><figure><img src="https://ws1.sinaimg.cn/large/006tNc79ly1fhp9dw6vxpj307406ewek.jpg" alt="icon" title="React icon" /><figcaption>icon<figcaption></figure></p>
<blockquote>
<p>æ‰€è°“Promiseï¼Œç®€å•è¯´å°±æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œé‡Œé¢ä¿å­˜ç€æŸä¸ªæœªæ¥æ‰ä¼šç»“æŸçš„äº‹ä»¶ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼‰çš„ç»“æœã€‚ä»è¯­æ³•ä¸Šè¯´ï¼ŒPromise æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä»å®ƒå¯ä»¥è·å–å¼‚æ­¥æ“ä½œçš„æ¶ˆæ¯ã€‚</p>
</blockquote>
<span id="more"></span><!-- more -->
<h3><a id="promise%E7%8A%B6%E6%80%81" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Promise çŠ¶æ€</h3>
<ul>
<li>Pending è¿›è¡Œä¸­</li>
<li>Resolved å·²å®Œæˆ åˆç§°Fulfilled</li>
<li>Rejected å·²å¤±è´¥</li>
</ul>
<h3><a id="promise%E7%89%B9%E7%82%B9" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Promise ç‰¹ç‚¹</h3>
<ul>
<li>å¯¹è±¡çš„çŠ¶æ€ä¸å—å¤–éƒ¨å› ç´ å½±å“ã€‚Promiseå¯¹è±¡ä»£è¡¨çš„æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œåªæœ‰å¼‚æ­¥æ“ä½œçš„ç»“æœèƒ½å†³å®šPromiseçš„çŠ¶æ€ï¼Œä»»ä½•å…¶ä»–æ“ä½œéƒ½ä¸èƒ½å†³å®šå…¶çŠ¶æ€ã€‚</li>
<li>ä¸€æ—¦Promiseæœ‰äº†ç»“æœçŠ¶æ€å°±ä¸ä¼šå†å˜ã€‚<code>Pending==&gt;Resolved</code>,æˆ–è€…<code>Pending==&gt;Rejected</code></li>
</ul>
<h3><a id="promise%E7%BC%BA%E7%82%B9" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Promise ç¼ºç‚¹</h3>
<p>Promiseçš„ç¼ºç‚¹æ˜¯ï¼šä¸€æ—¦å»ºç«‹å°±ä¼šç«‹å³æ‰§è¡Œï¼Œæ— æ³•ä¸­é€”å–æ¶ˆã€‚</p>
<h2><a id="promise%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Promise åŸºæœ¬ç”¨æ³•</h2>
<pre><code class="language-JavaScript">var promise = new Promise(function(resolve, reject) {
  // ... some code

  if (/* å¼‚æ­¥æ“ä½œæˆåŠŸ */){
    resolve(value);
  } else {
    reject(error);
  }
});
</code></pre>
<p>Promiseå¯¹è±¡æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ä½“ã€‚
è¿™ä¸ªå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªæ˜¯resolveï¼Œä¸€ä¸ªæ˜¯rejectã€‚è¿™ä¸¤ä¸ªå‚æ•°æ˜¯Promiseè‡ªåŠ¨æä¾›ï¼Œä¸éœ€è¦ä½¿ç”¨è€…ä¼ å€¼ã€‚</p>
<ul>
<li>resolveå‡½æ•°çš„ä½œç”¨æ˜¯ï¼Œå°†Promiseå¯¹è±¡çš„çŠ¶æ€ä»â€œæœªå®Œæˆâ€å˜ä¸ºâ€œæˆåŠŸâ€ï¼ˆå³ä» Pending å˜ä¸º Resolvedï¼‰ï¼Œåœ¨å¼‚æ­¥æ“ä½œæˆåŠŸæ—¶è°ƒç”¨ï¼Œå¹¶å°†å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œä½œä¸ºå‚æ•°ä¼ é€’å‡ºå»</li>
<li>rejectå‡½æ•°çš„ä½œç”¨æ˜¯ï¼Œå°†Promiseå¯¹è±¡çš„çŠ¶æ€ä»â€œæœªå®Œæˆâ€å˜ä¸ºâ€œå¤±è´¥â€ï¼ˆå³ä» Pending å˜ä¸º Rejectedï¼‰ï¼Œåœ¨å¼‚æ­¥æ“ä½œå¤±è´¥æ—¶è°ƒç”¨ï¼Œå¹¶å°†å¼‚æ­¥æ“ä½œæŠ¥å‡ºçš„é”™è¯¯ï¼Œä½œä¸ºå‚æ•°ä¼ é€’å‡ºå»ã€‚
Promiseå®ä¾‹ç”Ÿæˆåï¼Œå¯ä»¥ç”¨thenåˆ†åˆ«æŒ‡å®šResolvedå’ŒRejectedçš„å›è°ƒå‡½æ•°ã€‚</li>
</ul>
<pre><code class="language-JavaScript">promise.then(function(value) {
  // success
}, function(error) {
  // failure
});
</code></pre>
<p>thenæ–¹æ³•ä¼šæ¥å—ä¸¤ä¸ªå‚æ•°ï¼š</p>
<ul>
<li>ç¬¬ä¸€ä¸ªå‡½æ•°ï¼ŒPromiseçŠ¶æ€å˜æ›´ä¸ºResolvedæ—¶è°ƒç”¨ã€‚</li>
<li>ç¬¬äºŒä¸ªå‡½æ•°ï¼ŒPromiseçŠ¶æ€å˜ä¸ºRejectedæ—¶è°ƒç”¨ã€‚å¯é€‰çš„ï¼Œå¯ä»¥ä¸æä¾›ã€‚</li>
</ul>
<p>ä¸‹é¢æ˜¯å¼‚æ­¥åŠ è½½å›¾ç‰‡çš„ä¾‹å­ï¼š</p>
<pre><code class="language-JavaScript">function loadImageAsync(url) {
  return new Promise(function(resolve, reject) {
    var image = new Image();

    image.onload = function() {
      resolve(image);
    };

    image.onerror = function() {
      reject(new Error('Could not load image at ' + url));
    };

    image.src = url;
  });
}
</code></pre>
<p>ä¸‹é¢æ˜¯Promiseå®ç°çš„Ajaxæ“ä½œçš„ä¾‹å­ï¼š</p>
<pre><code class="language-JavaScript">var getJSON = function(url) {
  var promise = new Promise(function(resolve, reject){
    var client = new XMLHttpRequest();
    client.open(&quot;GET&quot;, url);
    client.onreadystatechange = handler;
    client.responseType = &quot;json&quot;;
    client.setRequestHeader(&quot;Accept&quot;, &quot;application/json&quot;);
    client.send();
    function handler() {
      if (this.readyState !== 4) {
        return;
      }
      if (this.status === 200) {
        resolve(this.response);
      } else {
        reject(new Error(this.statusText));
      }
    };
  });

  return promise;
};

getJSON(&quot;/posts.json&quot;).then(function(json) {
  console.log('Contents: ' + json);
}, function(error) {
  console.error('å‡ºé”™äº†', error);
});
</code></pre>
<p><strong>æ³¨æ„ï¼šåœ¨getJSONå†…éƒ¨ï¼Œresolveå‡½æ•°å’Œrejectå‡½æ•°è°ƒç”¨æ—¶ï¼Œéƒ½å¸¦æœ‰å‚æ•°ï¼ï¼</strong><br />
å¦‚æœè°ƒç”¨resolveå‡½æ•°å’Œrejectå‡½æ•°æ—¶å¸¦æœ‰å‚æ•°ï¼Œé‚£ä¹ˆå®ƒä»¬çš„å‚æ•°ä¼šè¢«ä¼ é€’ç»™å›è°ƒå‡½æ•°ã€‚</p>
<ul>
<li>rejectå‡½æ•°çš„å‚æ•°é€šå¸¸æ˜¯Errorå¯¹è±¡çš„å®ä¾‹ï¼Œè¡¨ç¤ºæŠ›å‡ºçš„é”™è¯¯</li>
<li>resolveå‡½æ•°çš„å‚æ•°é™¤äº†æ­£å¸¸çš„å€¼ä»¥å¤–ï¼Œè¿˜å¯èƒ½æ˜¯å¦ä¸€ä¸ª Promise å®ä¾‹ï¼Œè¡¨ç¤ºå¼‚æ­¥æ“ä½œçš„ç»“æœæœ‰å¯èƒ½æ˜¯ä¸€ä¸ªå€¼ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯å¦ä¸€ä¸ªå¼‚æ­¥æ“ä½œ</li>
</ul>
<pre><code class="language-JavaScript">var p1 = new Promise(function (resolve, reject) {
  // ...
});

var p2 = new Promise(function (resolve, reject) {
  // ...
  resolve(p1);
})
</code></pre>
<p>ä¸Šé¢ğŸ‘†ï¼Œ<code>p1</code>ã€<code>p2</code> éƒ½æ˜¯Promiseï¼Œä½†æ˜¯<code>p2</code>çš„resolveæŠŠ<code>p1</code>ä½œä¸ºè¿”å›å€¼å‚æ•°ä¼ å‡ºå»äº†ï¼Œå³ä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„è¿”å›ç»“æœæ˜¯å¦ä¸€ä¸ªå¼‚æ­¥æ“ä½œã€‚ï¼ˆç±»ä¼¼äºiOSå¼€å‘ä¸­çš„è‡ªåŠ¨å¸ƒå±€åº“ <code>Masonry</code>,å¯ä»¥æ— é™ç‚¹è¯­æ³•å–åˆ°å¯¹è±¡ï¼‰ã€‚<br />
<strong>æ³¨æ„ï¼šæ­¤æ—¶ï¼Œp1çš„çŠ¶æ€ä¼šä¼ é€’p2.å¦‚æœp1æ˜¯PendingçŠ¶æ€,é‚£ä¹ˆp2ä¼šç­‰å¾…p1çš„ç»“æœã€‚å¦‚æœp1æ˜¯Rejectæˆ–è€…ResolveçŠ¶æ€ï¼Œé‚£ä¹ˆp2çš„å›è°ƒå‡½æ•°å°†ä¼šç«‹å³æ‰§è¡Œã€‚</strong></p>
<p><strong>å†çœ‹:</strong></p>
<pre><code class="language-JavaScript">var p1 = new Promise(function (resolve, reject) {
  setTimeout(() =&gt; reject(new Error('fail')), 3000)
})

var p2 = new Promise(function (resolve, reject) {
  setTimeout(() =&gt; resolve(p1), 1000)
})

p2.then(result =&gt; console.log(result))
  .catch(error =&gt; console.log(error))
// Error: fail
</code></pre>
<ol>
<li><code>p1</code>ä¼šåœ¨3ç§’åæŠ›å‡ºerrorã€‚</li>
<li><code>p2</code>ä¼šåœ¨1ç§’åæ”¹å˜çŠ¶æ€ã€‚Resolvçš„è¿”å›å€¼æ˜¯<code>p1</code>.</li>
<li>ç”±äº<code>p2</code>çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªPromiseï¼Œå¯¼è‡´<code>p2</code>è‡ªå·±çš„çŠ¶æ€æ— æ•ˆäº†ï¼Œæ­¤æ—¶<code>p2</code>çš„çŠ¶æ€å–å†³äº<code>p1</code>.</li>
<li>æ‰€ä»¥ï¼Œåé¢çš„thenè¯­å¥ï¼Œéƒ½å˜æˆé’ˆå¯¹p1çš„äº†ã€‚</li>
<li>åˆè¿‡äº†<code>2ç§’</code>ï¼Œ<code>p1</code>å˜ä¸º<code>reject</code>ï¼Œå¯¼è‡´è§¦å‘<code>catch</code>æ–¹æ³•ã€‚</li>
</ol>
<h2><a id="3-promise-prototype-then" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>3. Promise.prototype.then()</h2>
<p><strong>thenæ–¹æ³•æ˜¯å®šä¹‰åœ¨åŸå‹å¯¹è±¡Promise.prototypeä¸Šçš„ã€‚</strong>
ä½œç”¨ï¼šä¸ºPromiseå¯¹è±¡æ·»åŠ çŠ¶æ€æ”¹å˜æ—¶çš„å›è°ƒå‡½æ•°ã€‚ç¬¬ä¸€ä¸ªæ˜¯Resolvedï¼Œç¬¬äºŒä¸ªæ˜¯Rejectedã€‚
thenæ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªæ–°çš„Promiseå¯¹è±¡ï¼Œä¸æ˜¯ä¹‹å‰çš„å®ä¾‹ã€‚å› æ­¤ thenæ–¹æ³•åé¢è¿˜å¯ä»¥å†å†™ä¸€ä¸ªthenæ–¹æ³•,å³é“¾å¼è°ƒç”¨ã€‚</p>
<pre><code class="language-JavaScript">getJSON(&quot;/posts.json&quot;).then(function(json) {
  return json.post;
}).then(function(post) {
  // ...
});
</code></pre>
<p>ç¬¬ä¸€ä¸ªå›è°ƒå‡½æ•°å®Œæˆä»¥åï¼Œä¼šå°†è¿”å›ç»“æœä½œä¸ºå‚æ•°ï¼Œä¼ å…¥ç¬¬äºŒä¸ªå›è°ƒå‡½æ•°ã€‚</p>
<pre><code class="language-JavaScript">getJSON(&quot;/post/1.json&quot;).then(function(post) {
  return getJSON(post.commentURL);
}).then(function funcA(comments) {
  console.log(&quot;Resolved: &quot;, comments);
}, function funcB(err){
  console.log(&quot;Rejected: &quot;, err);
});
</code></pre>
<p>ç¬¬ä¸€ä¸ªthenå‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªæ–°çš„Promiseå¯¹è±¡ã€‚äºæ˜¯æ‰èƒ½ç»§ç»­è°ƒç”¨thenæ–¹æ³•ã€‚
ç¬¬äºŒä¸ªthenæ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ï¼Œå°±ä¼šç­‰å¾…è¿™ä¸ªPromiseå¯¹è±¡çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œresolvä¼šè°ƒç”¨funcA,rejectä¼šè°ƒç”¨funcB.</p>
<p>ä¸‹é¢ğŸ‘‡æ˜¯ç®­å¤´å‡½æ•°çš„å®ç°ï¼Œä¼šæ›´ç®€æ´ï¼š</p>
<pre><code class="language-JavaScript">getJSON(&quot;/post/1.json&quot;).then(
  post =&gt; getJSON(post.commentURL)
).then(
  comments =&gt; console.log(&quot;Resolved: &quot;, comments),
  err =&gt; console.log(&quot;Rejected: &quot;, err)
);
</code></pre>
<h2><a id="4-promise-prototype-catch" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>4. Promise.prototype.catch()</h2>
<h3><a id="promise-prototype-catch%E6%96%B9%E6%B3%95%E6%98%AF-then-null-rejection%E7%9A%84%E5%88%AB%E5%90%8D%EF%BC%8C%E7%94%A8%E4%BA%8E%E6%8C%87%E5%AE%9A%E5%8F%91%E7%94%9F%E9%94%99%E8%AF%AF%E6%97%B6%E7%9A%84%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Promise.prototype.catchæ–¹æ³•æ˜¯.then(null, rejection)çš„åˆ«åï¼Œç”¨äºæŒ‡å®šå‘ç”Ÿé”™è¯¯æ—¶çš„å›è°ƒå‡½æ•°</h3>
<p><strong>Promise.prototype.catchæ–¹æ³•æ˜¯.then(null, rejection)çš„åˆ«åï¼Œç”¨äºæŒ‡å®šå‘ç”Ÿé”™è¯¯æ—¶çš„å›è°ƒå‡½æ•°.</strong></p>
<pre><code class="language-JavaScript">getJSON('/posts.json').then(function(posts) {
  // ...
}).catch(function(error) {
  // å¤„ç† getJSON å’Œ å‰ä¸€ä¸ªå›è°ƒå‡½æ•°è¿è¡Œæ—¶å‘ç”Ÿçš„é”™è¯¯
  console.log('å‘ç”Ÿé”™è¯¯ï¼', error);
});
</code></pre>
<p>getJSON()æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªPromiseå¯¹è±¡ã€‚å¦‚æœresolvï¼Œä¼šè°ƒç”¨thenæ–¹æ³•ï¼›å¦‚æœrejectåˆ™ä¼šè°ƒç”¨catchæ–¹æ³•ã€‚</p>
<h3><a id="then%E6%96%B9%E6%B3%95%E6%8C%87%E5%AE%9A%E7%9A%84%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0%EF%BC%8C%E5%A6%82%E6%9E%9C%E8%BF%90%E8%A1%8C%E4%B8%AD%E6%8A%9B%E5%87%BA%E9%94%99%E8%AF%AF%EF%BC%8C%E4%B9%9F%E4%BC%9A%E8%A2%ABcatch%E6%96%B9%E6%B3%95%E6%8D%95%E8%8E%B7" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>thenæ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ï¼Œå¦‚æœè¿è¡Œä¸­æŠ›å‡ºé”™è¯¯ï¼Œä¹Ÿä¼šè¢«catchæ–¹æ³•æ•è·</h3>
<p><strong>å¦å¤–ï¼Œthenæ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ï¼Œå¦‚æœè¿è¡Œä¸­æŠ›å‡ºé”™è¯¯ï¼Œä¹Ÿä¼šè¢«catchæ–¹æ³•æ•è·</strong></p>
<pre><code class="language-JavaScript">p.then((val) =&gt; console.log('fulfilled:', val))
  .catch((err) =&gt; console.log('rejected', err));

// ç­‰åŒäº
p.then((val) =&gt; console.log('fulfilled:', val))
  .then(null, (err) =&gt; console.log(&quot;rejected:&quot;, err));
</code></pre>
<pre><code class="language-plain_text">var promise = new Promise(function(resolve, reject) {
  throw new Error('test');
});
promise.catch(function(error) {
  console.log(error);
});
// Error: test
</code></pre>
<p>Promiseå¯¹è±¡Resolvedï¼Œä½†æ˜¯ResolvedæŒ‡å®šçš„æ–¹æ³•è·‘å‡ºé”™è¯¯ã€‚
Promiseå¯¹è±¡catchæ–¹æ³•èƒ½æ•è·è·‘å‡ºçš„errorã€‚</p>
<h3><a id="reject%E6%96%B9%E6%B3%95%E7%AD%89%E5%90%8C%E4%BA%8E%E6%8A%9B%E5%87%BA%E9%94%99%E8%AF%AF" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>rejectæ–¹æ³•ç­‰åŒäºæŠ›å‡ºé”™è¯¯</h3>
<p>ä¸Šé¢çš„å†™æ³•è·Ÿä¸‹é¢çš„ä¸¤ç§å†™æ³•æ˜¯ä¸€æ ·çš„ï¼š</p>
<pre><code class="language-plain_text">// å†™æ³•ä¸€
var promise = new Promise(function(resolve, reject) {
  try {
    throw new Error('test');
  } catch(e) {
    reject(e);
  }
});
promise.catch(function(error) {
  console.log(error);
});

// å†™æ³•äºŒ
var promise = new Promise(function(resolve, reject) {
  reject(new Error('test'));
});
promise.catch(function(error) {
  console.log(error);
});
</code></pre>
<p><strong>ç”±æ­¤å¯è§ï¼šrejectæ–¹æ³•ç­‰åŒäºæŠ›å‡ºé”™è¯¯ã€‚</strong></p>
<h3><a id="resolve%E4%B9%8B%E5%90%8E%E5%9C%A8%E6%8A%9B%E5%87%BA%E9%94%99%E8%AF%AF%EF%BC%8Ccatch%E6%98%AF%E6%8D%95%E8%8E%B7%E4%B8%8D%E5%88%B0%E7%9A%84%E4%B8%8D%E5%88%B0%E7%9A%84%E3%80%82" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>resolveä¹‹ååœ¨æŠ›å‡ºé”™è¯¯ï¼Œcatchæ˜¯æ•è·ä¸åˆ°çš„ä¸åˆ°çš„ã€‚</h3>
<pre><code class="language-plain_text">var promise = new Promise(function(resolve, reject) {
  resolve('ok');
  throw new Error('test');
});
promise
  .then(function(value) { console.log(value) })
  .catch(function(error) { console.log(error) });
// ok
</code></pre>
<p><strong>resolveä¹‹ååœ¨æŠ›å‡ºé”™è¯¯ï¼Œcatchæ˜¯æ•è·ä¸åˆ°çš„ä¸åˆ°çš„ã€‚</strong></p>
<h3><a id="promise%E5%AF%B9%E8%B1%A1%E7%9A%84%E9%94%99%E8%AF%AF%E5%85%B7%E6%9C%89%E2%80%9C%E5%86%92%E6%B3%A1%E2%80%9D%E6%80%A7%E8%B4%A8" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Promise å¯¹è±¡çš„é”™è¯¯å…·æœ‰â€œå†’æ³¡â€æ€§è´¨</h3>
<p><strong>Promise å¯¹è±¡çš„é”™è¯¯å…·æœ‰â€œå†’æ³¡â€æ€§è´¨,ä¼šä¸€ç›´å‘åä¼ é€’ï¼Œç›´åˆ°è¢«æ•è·ä¸ºæ­¢ ------ é”™è¯¯æ€»æ˜¯ä¼šè¢«ä¸‹ä¸€ä¸ªcatchè¯­å¥æ•è·</strong></p>
<blockquote>
<p>ä¸¾ä¸ªæ —å­ï¼šå°±åƒæ˜¯YæŸ“è‰²ä½“ä¸Šå—ç¯å¢ƒè§¦å‘çš„é—ä¼ ç–¾ç—…ï¼Œä¼šä¸æ–­çš„é—ä¼ ç»™ç”·æ€§åä»£ï¼Œä»»æ„ä¸€ä¸ªç”·æ€§éƒ½ä¼šè¢«ç‰¹æ®Šçš„ç¯å¢ƒè§¦å‘ã€‚</p>
</blockquote>
<pre><code class="language-plain_text">getJSON('/post/1.json').then(function(post) {
  return getJSON(post.commentURL);
}).then(function(comments) {
  // some code
}).catch(function(error) {
  // å¤„ç†å‰é¢ä¸‰ä¸ªPromiseäº§ç”Ÿçš„é”™è¯¯
});
</code></pre>
<p>ä¸Šè¿°ä»£ç ä¸­æœ‰ä¸‰ä¸ªPromiseï¼Œç¬¬ä¸€ä¸ªç”±getJSONäº§ç”Ÿï¼Œåä¸¤ä¸ªç”±thenäº§ç”Ÿã€‚ä»–ä»¬ä¹‹ä¸­çš„ä»»ä½•ä¸€ä¸ªæŠ›å‡ºé”™è¯¯ï¼Œéƒ½ä¼šè¢«catchæ•è·ã€‚</p>
<p>ä¸€èˆ¬æ¥è®²ï¼Œå°½é‡ä¸è¦å®šä¹‰Promiseçš„rejectçŠ¶æ€çš„å›è°ƒå‡½æ•°ï¼Œæœ€å¥½æ€»æ˜¯ä½¿ç”¨catchå‡½æ•°ï¼Œå› ä¸ºcatchå‡½æ•°ä¸ä»…èƒ½æ•è·åˆ°rejectçŠ¶æ€ï¼Œè¿˜èƒ½æ•è·åˆ°resolveçŠ¶æ€æŒ‡å®šæ–¹æ³•ä¸‹æŠ›å‡ºçš„å¼‚å¸¸ã€‚</p>
<h3><a id="promise%E5%AF%B9%E8%B1%A1%E6%8A%9B%E5%87%BA%E7%9A%84%E9%94%99%E8%AF%AF%E4%B8%8D%E4%BC%9A%E4%BC%A0%E9%80%92%E5%88%B0%E5%A4%96%E5%B1%82%E4%BB%A3%E7%A0%81" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Promiseå¯¹è±¡æŠ›å‡ºçš„é”™è¯¯ä¸ä¼šä¼ é€’åˆ°å¤–å±‚ä»£ç </h3>
<p>å¦‚æœæ²¡æœ‰ä½¿ç”¨catchæ–¹æ³•æŒ‡å®šé”™è¯¯å¤„ç†çš„å›è°ƒå‡½æ•°ï¼ŒPromiseå¯¹è±¡æŠ›å‡ºçš„é”™è¯¯ä¸ä¼šä¼ é€’åˆ°å¤–å±‚ä»£ç ï¼Œå³ä¸ä¼šæœ‰ä»»ä½•ååº”ï¼Œè¿™ä¸€ç‚¹ä¸Šè·Ÿä¼ ç»Ÿçš„try/catchä»£ç å—ä¸åŒçš„ã€‚</p>
<pre><code class="language-plain_text">process.on('unhandledRejection', function (err, p) {
  console.error(err.stack)
});
</code></pre>
<p>æ—¶é—´çš„ç›‘å¬å‡½æ•°â€˜unhandledRejectionâ€™,æœ‰ä¸¤ä¸ªå‚æ•°ï¼š
ç¬¬ä¸€ä¸ªæ˜¯é”™è¯¯å¯¹è±¡
ç¬¬äºŒä¸ªæ˜¯æŠ¥é”™çš„Promiseå®ä¾‹</p>
<p>catchæ–¹æ³•è¿”å›çš„ä¹Ÿæ˜¯ä¸€ä¸ªPromiseå®ä¾‹ï¼Œæ‰€ä»¥åé¢è¿˜æ˜¯å¯ä»¥æ— é™çš„è°ƒç”¨thenæ–¹æ³•ã€‚
å¦‚æœcatchå‡½æ•°åœ¨å‡ ä¸ªthenä¸­é—´ï¼ŒäºŒæ‰§è¡Œè¿‡ç¨‹ä¸­éƒ½æ²¡æœ‰rejectçŠ¶æ€ï¼Œé‚£ä¹ˆä¼šè·³è¿‡è¿™ä¸ªä¸­é—´çš„catchæ–¹æ³•ã€‚</p>
<h3><a id="catch%E6%96%B9%E6%B3%95%E4%B8%AD%E4%B9%9F%E8%83%BD%E6%8A%9B%E5%87%BA%E9%94%99%E8%AF%AF" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>catchæ–¹æ³•ä¸­ä¹Ÿèƒ½æŠ›å‡ºé”™è¯¯</h3>
<pre><code class="language-plain_text">var someAsyncThing = function() {
  return new Promise(function(resolve, reject) {
    // ä¸‹é¢ä¸€è¡Œä¼šæŠ¥é”™ï¼Œå› ä¸ºxæ²¡æœ‰å£°æ˜
    resolve(x + 2);
  });
};

someAsyncThing().then(function() {
  return someOtherAsyncThing();
}).catch(function(error) {
  console.log('oh no', error);
  // ä¸‹é¢ä¸€è¡Œä¼šæŠ¥é”™ï¼Œå› ä¸ºyæ²¡æœ‰å£°æ˜
  y + 2;
}).then(function() {
  console.log('carry on');
});
// oh no [ReferenceError: x is not defined]
</code></pre>
<p>å¦‚ä¸Šï¼šcatchæ–¹æ³•æŒ‡å®šçš„å‡½æ•°ä¾æ—§æ˜¯å¯ä»¥æŠ›å‡ºErrorçš„ï¼Œä½†æ˜¯å› ä¸ºåé¢æ²¡æœ‰ç»§ç»­è·Ÿè¿›catchæ–¹æ³•ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰è¢«æ•è·ã€‚</p>
<h2><a id="5-promise-all" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>5. Promise.all()</h2>
<p><strong>Promise.allæ–¹æ³•ç”¨äºå°†å¤šä¸ª Promise å®ä¾‹ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ã€‚</strong></p>
<pre><code class="language-plain_text">var p = Promise.all([p1, p2, p3]);
</code></pre>
<p>Promise.allæ–¹æ³•æ¥å—ä¸€ä¸ªæ•°ç»„ä½œä¸ºå‚æ•°ï¼Œp1ã€p2ã€p3éƒ½æ˜¯ Promise å®ä¾‹ï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±ä¼šå…ˆè°ƒç”¨ä¸‹é¢è®²åˆ°çš„Promise.resolveæ–¹æ³•ï¼Œå°†å‚æ•°è½¬ä¸º Promise å®ä¾‹ï¼Œå†è¿›ä¸€æ­¥å¤„ç†ã€‚
ï¼ˆPromise.allæ–¹æ³•çš„å‚æ•°å¯ä»¥ä¸æ˜¯æ•°ç»„ï¼Œä½†å¿…é¡»å…·æœ‰ Iterator æ¥å£ï¼Œä¸”è¿”å›çš„æ¯ä¸ªæˆå‘˜éƒ½æ˜¯ Promise å®ä¾‹ã€‚ï¼‰</p>
<p>pçš„çŠ¶æ€ç”±p1ã€p2ã€p3å†³å®šï¼Œåˆ†æˆä¸¤ç§æƒ…å†µ:</p>
<ul>
<li>åªæœ‰p1ã€p2ã€p3çš„çŠ¶æ€éƒ½å˜æˆfulfilledï¼Œpçš„çŠ¶æ€æ‰ä¼šå˜æˆfulfilledï¼Œæ­¤æ—¶p1ã€p2ã€p3çš„è¿”å›å€¼ç»„æˆä¸€ä¸ªæ•°ç»„ï¼Œä¼ é€’ç»™pçš„å›è°ƒå‡½æ•°</li>
<li>åªè¦p1ã€p2ã€p3ä¹‹ä¸­æœ‰ä¸€ä¸ªè¢«rejectedï¼Œpçš„çŠ¶æ€å°±å˜æˆrejectedï¼Œæ­¤æ—¶ç¬¬ä¸€ä¸ªè¢«rejectçš„å®ä¾‹çš„è¿”å›å€¼ï¼Œä¼šä¼ é€’ç»™pçš„å›è°ƒå‡½æ•°</li>
</ul>
<p><strong>æ³¨æ„ï¼Œå¦‚æœä½œä¸ºå‚æ•°çš„ Promise å®ä¾‹ï¼Œè‡ªå·±å®šä¹‰äº†catchæ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒä¸€æ—¦è¢«rejectedï¼Œå¹¶ä¸ä¼šè§¦å‘Promise.all()çš„catchæ–¹æ³•ã€‚</strong></p>
<pre><code class="language-plain_text">const p1 = new Promise((resolve, reject) =&gt; {
  resolve('hello');
})
.then(result =&gt; result)
.catch(e =&gt; e);

const p2 = new Promise((resolve, reject) =&gt; {
  throw new Error('æŠ¥é”™äº†');
})
.then(result =&gt; result)
.catch(e =&gt; e);

Promise.all([p1, p2])
.then(result =&gt; console.log(result))
.catch(e =&gt; console.log(e));
// [&quot;hello&quot;, Error: æŠ¥é”™äº†]
</code></pre>
<p>p1ä¼šresolvedï¼Œp2é¦–å…ˆä¼šrejected.
p2æœ‰è‡ªå·±çš„catchæ–¹æ³•ï¼Œå¹¶ä¸”æ‰§è¡Œäº†ï¼Œé‚£ä¹ˆå°±ä¼šè¿”å›ä¸€ä¸ªæ–°çš„Promiseï¼Œå¹¶ä¸”è¿™ä¸ªPromiseçš„çŠ¶æ€ä¼šå˜æˆResolvedã€‚
æ‰€ä»¥ï¼šPromise.all()çš„catchæ–¹æ³•å¹¶ä¸èƒ½æ•è·åˆ°è¿™ä¸ªerrorã€‚
p2æ²¡æœ‰è‡ªå·±çš„catchæ–¹æ³•ï¼Œæ‰€ä»¥ä¼šè°ƒç”¨Promise.all()çš„catchæ–¹æ³•ã€‚</p>
<h2><a id="6-promise-race" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>6. Promise.race()</h2>
<p>Promise.raceæ–¹æ³•åŒæ ·æ˜¯å°†å¤šä¸ªPromiseå®ä¾‹ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„Promiseå®ä¾‹ã€‚</p>
<pre><code class="language-plain_text">var p = Promise.race([p1, p2, p3]);
</code></pre>
<p>p1/p2/p3ä¸­åªè¦æœ‰ä¸€ä¸ªç‡å…ˆæ”¹å˜çŠ¶æ€ï¼Œpçš„çŠ¶æ€å°±ä¼šéšç€æ”¹å˜ã€‚é‚£ä¸ªç‡å…ˆæ”¹å˜çŠ¶æ€çš„å®ä¾‹çš„è¿”å›å€¼ï¼Œå°±ä¼šä¼ é€’ç»™pçš„å›è°ƒå‡½æ•°ã€‚</p>
<pre><code class="language-plain_text">const p = Promise.race([
  fetch('/resource-that-may-take-a-while'),
  new Promise(function (resolve, reject) {
    setTimeout(() =&gt; reject(new Error('request timeout')), 5000)
  })
]);
p.then(response =&gt; console.log(response));
p.catch(error =&gt; console.log(error));
</code></pre>
<p>5ç§’å†…æ— æ³•è¿”å›è¯·æ±‚ç»“æœï¼Œå˜é‡pçš„çŠ¶æ€å°±ä¼šå˜ä¸ºrejectã€‚è¿™ä¹Ÿç®—æ˜¯ç«é€Ÿçš„ä¸€ç§åº”ç”¨åœºæ™¯ã€‚</p>
<h2><a id="7-promise-resolve" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>7. Promise.resolve()</h2>
<p>æœ‰æ—¶éœ€è¦å°†ç°æœ‰å¯¹è±¡è½¬ä¸ºPromiseå¯¹è±¡ï¼ŒPromise.resolveæ–¹æ³•å°±èµ·åˆ°è¿™ä¸ªä½œç”¨.</p>
<pre><code class="language-plain_text">var jsPromise = Promise.resolve($.ajax('/whatever.json'));
</code></pre>
<p>ç­‰ä»·äºä¸‹é¢çš„è¯´æ³•ï¼š</p>
<pre><code class="language-plain_text">Promise.resolve('foo')
// ç­‰ä»·äº
new Promise(resolve =&gt; resolve('foo'))
</code></pre>
<p>Promise çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªç®­å¤´å‡½æ•°ï¼Œå‡½æ•°çš„ä¼ å…¥å‚æ•°æ˜¯resolveï¼ˆå‡½æ•°ï¼‰ï¼Œå‡½æ•°ä½“å°±æ˜¯è°ƒç”¨ä¼ å…¥çš„å‡½æ•°resolveï¼Œresolveè°ƒç”¨çš„æ—¶å€™ï¼Œä¹Ÿéœ€è¦ä¸€ä¸ªå‚æ•°ï¼Œæ­¤æ—¶è¿™ä¸ªå‚æ•°å°±æ˜¯å’±ä»¬éœ€è¦è½¬å˜æˆPromiseå¯¹è±¡çš„é‚£ä¸ªå‚æ•°ã€‚</p>
<p>Promise.resolveçš„å‚æ•°æœ‰å››ç§æƒ…å†µï¼š</p>
<ol>
<li>å‚æ•°æ˜¯ä¸€ä¸ªPromiseå®ä¾‹</li>
<li>å‚æ•°æ˜¯ä¸€ä¸ªthenableå¯¹è±¡ï¼ˆæœ‰thenæ–¹æ³•çš„å®ä¾‹ï¼‰</li>
<li>å‚æ•°æ˜¯ä¸å…·å¤‡thenæ–¹æ³•dçš„å¯¹è±¡åº”è¯¥</li>
<li>ä¸å¸¦å‚æ•°ï¼Œè¿”å›ä¸€ä¸ªResolvedçš„è¿”å›çŠ¶æ€ã€‚</li>
</ol>
<h2><a id="8%E3%80%81promise-reject%E5%90%8C%E4%B8%8A" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>8ã€Promise.reject()   åŒä¸Š</h2>
<h2><a id="9%E3%80%81%E4%B8%A4%E4%B8%AA%E5%B8%B8%E7%94%A8%E9%99%84%E5%8A%A0%E6%96%B9%E6%B3%95" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>9ã€ä¸¤ä¸ªå¸¸ç”¨é™„åŠ æ–¹æ³•</h2>
<h3><a id="done" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>done()</h3>
<p>Promiseçš„é”™è¯¯å¹¶ä¸ä¼šå†’æ³¡åˆ°å…¨å±€ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æä¾›ä¸€ä¸ªdoneæ–¹æ³•æ€»æ˜¯å¤„äºä¼šåŠé“¾çš„å°¾ç«¯ã€‚</p>
<pre><code class="language-plain_text">asyncFunc()
  .then(f1)
  .catch(r1)
  .then(f2)
  .done();
</code></pre>
<p>doneæ–¹æ³•çš„ä½¿ç”¨ï¼Œå¯ä»¥åƒthenæ–¹æ³•é‚£æ ·ç”¨ï¼Œæä¾›Fulfilledå’ŒRejectedçŠ¶æ€çš„å›è°ƒå‡½æ•°ï¼Œä¹Ÿå¯ä»¥ä¸æä¾›ä»»ä½•å‚æ•°ã€‚ä½†ä¸ç®¡æ€æ ·ï¼Œdoneéƒ½ä¼šæ•æ‰åˆ°ä»»ä½•å¯èƒ½å‡ºç°çš„é”™è¯¯ï¼Œå¹¶å‘å…¨å±€æŠ›å‡º.</p>
<h3><a id="finally" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>finally()</h3>
<p>finallyæ–¹æ³•ç”¨äºæŒ‡å®šä¸ç®¡Promiseå¯¹è±¡æœ€åçŠ¶æ€å¦‚ä½•ï¼Œéƒ½ä¼šæ‰§è¡Œçš„æ“ä½œã€‚å®ƒä¸doneæ–¹æ³•çš„æœ€å¤§åŒºåˆ«ï¼Œå®ƒæ¥å—ä¸€ä¸ªæ™®é€šçš„å›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°ä¸ç®¡æ€æ ·éƒ½å¿…é¡»æ‰§è¡Œã€‚</p>
<pre><code class="language-plain_text">Promise.prototype.finally = function (callback) {
  let P = this.constructor;
  return this.then(
    value  =&gt; P.resolve(callback()).then(() =&gt; value),
    reason =&gt; P.resolve(callback()).then(() =&gt; { throw reason })
  );
};
</code></pre>
<h3><a id="promis-try" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Promis.try()</h3>
<pre><code class="language-plain_text">try {
  database.users.get({id: userId})
  .then(...)
  .catch(...)
} catch (e) {
  // ...
}
</code></pre>
<pre><code class="language-plain_text">Promise.try(database.users.get({id: userId}))
  .then(...)
  .catch(...)
</code></pre>
<p>Promise.tryå°±æ˜¯æ¨¡æ‹Ÿtryä»£ç å—ï¼Œå°±åƒpromise.catchæ¨¡æ‹Ÿçš„æ˜¯catchä»£ç å—.</p>

              </div>
            </div>
            
            
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
    let post = new Vue({
     el: '#post',
     data: {
       hidelikecoin: ''
     },
     methods: {
       timeformat(raw) {
         return moment(raw).format("YYYY å¹´ MM æœˆ DD æ—¥");
       }
     },
     delimiters: ['$[', ']']
   })
  </script>      <div class="container">
      <hr>
      <div class="footer" id="footer">
        <div class="slogan">å€˜è‹¥æˆ‘å¿ƒä¸­çš„å±±æ°´ï¼Œä½ çœ¼ä¸­èƒ½çœ‹åˆ°ï¼Œæˆ‘ä¾¿ä¸€æ­¥ä¸€è²èŠ±ç¥ˆç¥·</div>
        <div class="meta">
          <p></p>
          <p>ã€ŒKaelindaã€ä½¿ç”¨ <a href="https://zh.mweb.im/" target="_blank">MWeb</a> å’Œ <a href="https://github.com/Astrian/reflect-white-mweb-theme" target="_blank">Reflect White</a> æ­å»ºã€‚</p>
          <p class='colorScheme'>è‰²å½©æ¨¡å¼ï¼š<span id='colorSchemeLight' onclick="changeColorScheme('light');">æ˜äº®</span> &middot; <span id='colorSchemeDark' onclick="changeColorScheme('dark')">é»‘æš—</span> &middot; <span id='colorSchemeSystem' onclick="changeColorScheme('system')">è·Ÿéšç³»ç»Ÿ</span></p>
        </div>
      </div>
      <script>
        let footer = new Vue({
          el: '#footer',
          data: {
            message: 'hello'
          },
          delimiters: ['$[', ']']
        })
      </script>
    </div>
  </div>
</body>
<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://cdn.bootcss.com/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://cdn.bootcss.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<style></style>
<script>
  changeColorScheme()
</script>
</html>